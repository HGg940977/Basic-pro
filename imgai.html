<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Pro - @BasicTouchPro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --tg-bg: #ffffff; --tg-text: #000000; --tg-sec: #707579;
            --tg-border: #e0e0e0; --tg-blue: #0088cc; --tg-card: #f8f9fa;
        }
        [data-theme="dark"] {
            --tg-bg: #17212b; --tg-text: #e1e3e6; --tg-sec: #a8b2bb;
            --tg-border: #2c3a48; --tg-card: #232f3d;
        }
        body { font-family: -apple-system, sans-serif; background: var(--tg-bg); color: var(--tg-text); margin: 0; padding: 0; overflow-x: hidden; }
        
        /* Header & Profile */
        .header {
            padding: 12px 15px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--tg-border); background: var(--tg-bg); position: sticky; top:0; z-index:100;
        }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo img { width: 32px; height: 32px; border-radius: 5px; }
        .logo-text { font-weight: bold; font-size: 18px; color: var(--tg-blue); }
        .profile { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--tg-blue); cursor: pointer; object-fit: cover; }

        .container { max-width: 550px; margin: 0 auto; padding: 20px; }
        
        /* Input Area */
        .card { background: var(--tg-card); border-radius: 15px; padding: 20px; border: 1px solid var(--tg-border); margin-bottom: 20px; position: relative; }
        label { font-size: 12px; color: var(--tg-sec); font-weight: bold; display: block; margin-bottom: 8px; }
        
        textarea { 
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--tg-border); 
            background: var(--tg-bg); color: var(--tg-text); outline: none; transition: 0.3s; box-sizing: border-box; font-size: 14px; resize: none;
        }
        textarea:focus { border-color: var(--tg-blue); box-shadow: 0 0 10px rgba(0, 136, 204, 0.2); }

        .btn-main { background: var(--tg-blue); color: #fff; border: none; padding: 14px; width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 15px; transition: 0.2s; }
        .btn-main:active { transform: scale(0.98); }

        /* Animation */
        #loading-box { display: none; text-align: center; padding: 40px 0; }
        .magic-orb { 
            width: 60px; height: 60px; background: radial-gradient(circle, #0088cc, #00ffcc); 
            border-radius: 50%; margin: 0 auto 20px; box-shadow: 0 0 20px #0088cc; animation: pulse 1.5s infinite alternate;
        }
        @keyframes pulse { from { transform: scale(0.9); opacity: 0.6; } to { transform: scale(1.1); opacity: 1; } }

        /* Result Display */
        #result-area { display: none; margin-top: 10px; }
        .generated-img { width: 100%; border-radius: 15px; border: 1px solid var(--tg-border); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .action-row { display: flex; gap: 10px; margin-top: 15px; }
        .btn-dl { background: #28a745; color: white; flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; text-align: center; text-decoration: none; font-size: 14px; }

        /* History (LocalStorage) */
        .history-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .history-item { aspect-ratio: 1/1; border-radius: 8px; overflow: hidden; border: 1px solid var(--tg-border); cursor: pointer; }
        .history-item img { width: 100%; height: 100%; object-fit: cover; }

        /* Modal Settings */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .modal-content { background: var(--tg-bg); padding: 25px; border-radius: 15px; width: 100%; max-width: 400px; }
    </style>
</head>
<body>

    <div class="header">
      <div class="logo">
        <img src="https://i.ibb.co/6c8B0DHm/20250728-114443.png" alt="Logo">
        <div class="logo-text">Basic Touch Pro</div>
      </div>
      <div style="display: flex; gap: 15px; align-items: center;">
        <i class="fas fa-sliders-h" style="color:var(--tg-sec); cursor:pointer; font-size:20px;" onclick="document.getElementById('setModal').style.display='flex'"></i>
        <img id="profile-pic" class="profile" src="" onclick="window.location.href='tg.html'">
      </div>
    </div>

    <div class="container">
        <h3><i class="fas fa-magic"></i> AI Image Generator</h3>
        
        <div class="card">
            <label>Describe what you want to see</label>
            <textarea id="imgPrompt" rows="3" placeholder="e.g. A futuristic city with flying cars in cyberpunk style..."></textarea>
            
            <button class="btn-main" id="genBtn" style="margin-top: 15px;">
                <i class="fas fa-sparkles"></i> GENERATE IMAGE
            </button>
        </div>

        <div id="loading-box">
            <div class="magic-orb"></div>
            <p style="font-weight: bold; color: var(--tg-sec);">AI is painting your imagination...</p>
        </div>

        <div id="result-area">
            <div class="card">
                <img id="mainResult" class="generated-img" src="">
                <div class="action-row">
                    <button class="btn-dl" id="dlBtn"><i class="fas fa-download"></i> SEND TO TELEGRAM</button>
                </div>
            </div>
        </div>

        <!-- Local History Section -->
        <div class="card" id="history-section" style="display: none;">
            <label><i class="fas fa-history"></i> Recent Generations</label>
            <div class="history-grid" id="historyGrid"></div>
            <button class="btn-main" style="background: transparent; color: #ff4444; border: 1px solid #ff4444; margin-top: 15px; font-size: 12px; padding: 8px;" onclick="clearHistory()">CLEAR HISTORY</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="setModal">
        <div class="modal-content">
            <h4><i class="fas fa-cog"></i> Settings</h4>
            <label>OpenRouter API Key</label>
            <input type="password" id="apiKey" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--tg-border);" placeholder="sk-or-v1-...">
            
            <label style="margin-top: 15px; display: block;">Select AI Model</label>
            <select id="modelSelect" style="width: 100%; padding: 10px; border-radius: 8px;">
                <option value="black-forest-labs/flux.2-pro">FLUX.2 Pro (High Quality)</option>
                <option value="sourceful/riverflow-v2-fast-preview">Riverflow V2 (Fast)</option>
                <option value="bytedance-seed/seedream-4.5">Seedream 4.5 (Artistic)</option>
            </select>
            
            <button class="btn-main" style="margin-top: 20px;" onclick="saveSettings()">SAVE SETTINGS</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.BackButton.show();
        tg.BackButton.onClick(() => window.location.href = "index.html");

        const user = tg.initDataUnsafe.user || {};
        document.getElementById('profile-pic').src = user.username ? `https://t.me/i/userpic/160/${user.username}.jpg` : "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";
        document.documentElement.setAttribute('data-theme', tg.colorScheme);

        let currentBase64 = "";

        window.onload = () => {
            document.getElementById('apiKey').value = localStorage.getItem('bt_img_key') || '';
            document.getElementById('modelSelect').value = localStorage.getItem('bt_img_model') || 'black-forest-labs/flux.2-pro';
            loadHistory();
        };

        function saveSettings() {
            localStorage.setItem('bt_img_key', document.getElementById('apiKey').value);
            localStorage.setItem('bt_img_model', document.getElementById('modelSelect').value);
            document.getElementById('setModal').style.display = 'none';
        }

        // Generate Logic
        document.getElementById('genBtn').onclick = async () => {
            const prompt = document.getElementById('imgPrompt').value;
            const apiKey = localStorage.getItem('bt_img_key');
            const model = localStorage.getItem('bt_img_model');

            if (!prompt || !apiKey) {
                if (!apiKey) document.getElementById('setModal').style.display = 'flex';
                else tg.showAlert("Please enter a description!");
                return;
            }

            document.getElementById('genBtn').disabled = true;
            document.getElementById('loading-box').style.display = 'block';
            document.getElementById('result-area').style.display = 'none';

            try {
                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [{ role: "user", content: prompt }],
                        modalities: ['image', 'text']
                    }),
                });

                const result = await response.json();
                
                if (result.choices && result.choices[0].message.images) {
                    currentBase64 = result.choices[0].message.images[0].image_url.url;
                    
                    document.getElementById('mainResult').src = currentBase64;
                    document.getElementById('result-area').style.display = 'block';
                    
                    saveToHistory(currentBase64);
                    if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                } else {
                    tg.showAlert("Generation failed. Check your API key or quota.");
                }
            } catch (e) {
                tg.showAlert("Connection Error!");
            } finally {
                document.getElementById('genBtn').disabled = false;
                document.getElementById('loading-box').style.display = 'none';
            }
        };

        // Send to Telegram (Download)
        document.getElementById('dlBtn').onclick = async () => {
            const btn = document.getElementById('dlBtn');
            btn.innerHTML = "<i class='fas fa-spinner fa-spin'></i> SENDING...";
            btn.disabled = true;

            const fd = new FormData();
            fd.append('action', 'send_to_tg');
            fd.append('chat_id', user.id || '');
            fd.append('image_data', currentBase64);
            fd.append('prompt', document.getElementById('imgPrompt').value);

            try {
                const res = await fetch(window.location.href, { method: 'POST', body: fd });
                const data = await res.json();
                if (data.ok) {
                    tg.showAlert("Image sent to your Telegram! âœ…");
                } else {
                    tg.showAlert("Failed to send to Telegram.");
                }
            } catch (e) {
                tg.showAlert("Server Error!");
            } finally {
                btn.innerHTML = "<i class='fas fa-download'></i> SEND TO TELEGRAM";
                btn.disabled = false;
            }
        };

        // Local Storage History
        function saveToHistory(base64) {
            let history = JSON.parse(localStorage.getItem('bt_img_history') || '[]');
            history.unshift(base64);
            if (history.length > 9) history.pop();
            localStorage.setItem('bt_img_history', JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('bt_img_history') || '[]');
            const grid = document.getElementById('historyGrid');
            const section = document.getElementById('history-section');
            
            if (history.length > 0) {
                section.style.display = 'block';
                grid.innerHTML = history.map(img => `
                    <div class="history-item" onclick="viewHistory('${img}')">
                        <img src="${img}">
                    </div>
                `).join('');
            } else {
                section.style.display = 'none';
            }
        }

        function viewHistory(base64) {
            currentBase64 = base64;
            document.getElementById('mainResult').src = base64;
            document.getElementById('result-area').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function clearHistory() {
            localStorage.removeItem('bt_img_history');
            loadHistory();
        }
    </script>
      
<script src="https://sad.adsgram.ai/js/sad.min.js"></script>

<script>
    window.addEventListener('load', function() {
        const AdController = window.Adsgram.init({ blockId: "int-19383" });

        AdController.show().then((result) => {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
                
                setTimeout(() => {
                    window.Telegram.WebApp.showAlert('Thanks for support ðŸ’');
                }, 200);
            }
        }).catch((error) => {
            console.log(error);
        });
    });
</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"0b168fba841b4c6ba25d388460bf2e18","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>